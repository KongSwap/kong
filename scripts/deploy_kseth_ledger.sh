#!/usr/bin/env bash

if [ -z "$1" ]
	then
		NETWORK=""
	else
		NETWORK="--network $1"
fi
IDENTITY="--identity kong_token_minter"
CONTROLLER_PRINCIPAL_ID=$(dfx identity ${NETWORK} ${IDENTITY} get-principal)

TRIGGER_THRESHOLD=10_000
NUM_OF_BLOCK_TO_ARCHIVE=5_000
CYCLE_FOR_ARCHIVE_CREATION=5_000_000_000_000
ICRC2_FEATURE_FLAG=true

TOKEN_SYMBOL="ksETH"
TOKEN_LEDGER=$(echo ${TOKEN_SYMBOL}_ledger | tr '[:upper:]' '[:lower:]')
TOKEN_NAME="KongSwap Ethereum (Test Token)"
TOKEN_DECIMALS=18
TRANSFER_FEE=2_000_000_000_000
TOKEN_LOGO="data:image/png;base64,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"

dfx deploy ${NETWORK} ${IDENTITY} ${TOKEN_LEDGER} --argument "(variant {Init =
	record {
		token_symbol = \"${TOKEN_SYMBOL}\";
		token_name = \"${TOKEN_NAME}\";
		decimals = opt ${TOKEN_DECIMALS};
		minting_account = record { owner = principal \"${CONTROLLER_PRINCIPAL_ID}\" };
		transfer_fee = ${TRANSFER_FEE};
		initial_balances = vec { };
		metadata = vec { record { \"icrc1:logo\"; variant { Text = \"${TOKEN_LOGO}\" }; }; };
		feature_flags = opt record { icrc2 = ${ICRC2_FEATURE_FLAG} };
		archive_options = record {
			num_blocks_to_archive = ${NUM_OF_BLOCK_TO_ARCHIVE};
			trigger_threshold = ${TRIGGER_THRESHOLD};
			controller_id = principal \"${CONTROLLER_PRINCIPAL_ID}\";
			cycles_for_archive_creation = opt ${CYCLE_FOR_ARCHIVE_CREATION};
		};
	}
})"

dfx generate ${TOKEN_LEDGER}
